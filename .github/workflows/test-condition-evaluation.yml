name: Test Condition Evaluation

on:
  push:
    branches:
      - fix/cd-prod-deploy-condition

jobs:
  set-output:
    name: Set Output to No
    runs-on: ubuntu-latest
    outputs:
      should_run: ${{ steps.set.outputs.value }}
    steps:
      - name: Set output to no
        id: set
        run: echo "value=no" >> $GITHUB_OUTPUT

      - name: Log output
        run: echo "Output value is '${{ steps.set.outputs.value }}'"

  test-broken-syntax:
    name: "BROKEN: Uses nested ${{ }}"
    runs-on: ubuntu-latest
    needs: [set-output]
    if: always() && ${{ startsWith(needs.set-output.outputs.should_run, 'yes') }}
    steps:
      - name: This should NOT run
        run: echo "BUG - This job ran even though should_run='no'"

  test-fixed-syntax:
    name: "FIXED: No nested ${{ }}"
    runs-on: ubuntu-latest
    needs: [set-output]
    if: always() && startsWith(needs.set-output.outputs.should_run, 'yes')
    steps:
      - name: This should NOT run
        run: echo "BUG - This job ran even though should_run='no'"

  test-broken-with-yes:
    name: "BROKEN with yes: Uses nested ${{ }}"
    runs-on: ubuntu-latest
    needs: [set-output]
    if: always() && ${{ startsWith('yes-test', 'yes') }}
    steps:
      - name: This SHOULD run
        run: echo "OK - This job ran as expected with hardcoded 'yes'"

  test-fixed-with-yes:
    name: "FIXED with yes: No nested ${{ }}"
    runs-on: ubuntu-latest
    needs: [set-output]
    if: always() && startsWith('yes-test', 'yes')
    steps:
      - name: This SHOULD run
        run: echo "OK - This job ran as expected with hardcoded 'yes'"
