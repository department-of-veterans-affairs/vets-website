name: Slack notification
description: Slack notification

inputs:
  channel_id:
    description: channel_id
    required: true
  payload:
    description: attached message
    required: true
  role:
    description: AWS IAM role to assume (required for OIDC)
    required: true
  aws_region:
    description: AWS region
    required: false
    default: 'us-gov-west-1'

runs:
  using: composite
  steps:
    - name: Configure AWS credentials
      uses: ./.github/workflows/configure-aws-credentials
      with:
        aws_region: ${{ inputs.aws_region }}
        role: ${{ inputs.role }}

    - name: Get Slack bot token
      uses: department-of-veterans-affairs/action-inject-ssm-secrets@latest
      with:
        ssm_parameter: /devops/github_actions_slack_bot_user_token
        env_variable_name: SLACK_BOT_TOKEN

    - name: Notify Slack
      uses: slackapi/slack-github-action@v1.25.0
      env:
        SLACK_BOT_TOKEN: ${{ env.SLACK_BOT_TOKEN }}
      with:
        payload: ${{ inputs.payload }}
        channel-id: ${{ inputs.channel_id }}
