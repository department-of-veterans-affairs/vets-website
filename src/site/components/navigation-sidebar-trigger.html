{% comment %}

=====================
Navigation side bar trigger
=====================

Used to open or close the side bar navigation bar on mobile screens. Must be
used in a template with navigation-sidebar.html

{% endcomment %}
<div class="va-btn-sidebarnav-trigger" id="sidebar-nav-trigger">
  <!-- The button background is to hide any content that is behind the trigger -->
  <div class="button-background"></div>
  <div class="button-wrapper">
    <button aria-controls="va-detailpage-sidebar">
      <strong>In this section</strong>
      {% include "src/site/assets/img/bars.svg" %}
    </button>
  </div>
</div>
<div class="trigger-placeholder"></div>

<script nonce="**CSP_NONCE**" type="text/javascript">
  var mobileMediaQuery = window.matchMedia('(max-width: 767px)');
  var navTrigger = document.getElementsByClassName("va-btn-sidebarnav-trigger")[0];
  var buttonWrapper = document.querySelector(".va-btn-sidebarnav-trigger .button-wrapper");
  var buttonBackground = document.querySelector(".va-btn-sidebarnav-trigger .button-background")
  var navTriggerPlaceholder = document.querySelector(".trigger-placeholder");
  var navTriggerOffset;

  // Helper to get the height of the nav button, with or without the bottom
  // padding. This is used to set the height of the button's placeholder and the
  // height of the white button background
  function getButtonHeight(withBottomPadding) {
    // If the mobile nav button is hidden, just return 0
    if (!mobileMediaQuery.matches) {
      return 0;
    }

    const style = window.getComputedStyle(buttonWrapper)
    const { height, paddingBottom } = style

    if (withBottomPadding) {
      return parseFloat(height)
    };

    return parseFloat(height) - parseFloat(paddingBottom);
  }

  function setHeightsAndOffsets() {
    if (document.readyState === 'complete') {
      navTriggerPlaceholder.style.height = `${getButtonHeight(true)}px`;
      buttonBackground.style.height = `${getButtonHeight(false)}px`;
      navTriggerOffset = navTriggerPlaceholder.offsetTop;
    }
  }

  document.onreadystatechange = setHeightsAndOffsets;

  window.addEventListener("resize", setHeightsAndOffsets, false);

  window.addEventListener("scroll", function () {
    if (mobileMediaQuery.matches) {
      if (navTriggerOffset < window.pageYOffset) {
        navTrigger.classList.add("fixed-trigger");
      } else {
        navTrigger.classList.remove("fixed-trigger");
      }
    }
  }, false);
</script>
